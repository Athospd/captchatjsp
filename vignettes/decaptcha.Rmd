---
title: "Vignette Title"
author: "Vignette Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r}
library(dplyr)
library(tidyr)
library(tree)
library(captchatjsp)
library(caret)
```

### Mostrando

```{r}
d <- ler(baixar())
desenhar(d)

# path <- 'inst/treino/'
# classificar(picotar(limpar(d)), 'qmiqx', path)
```

### Atualizar modelo

#### Base de treino
```{r}
d_treino <- carregar_treino('inst/treino/')
d_treino$letra <- as.factor(d_treino$letra)
```

#### Tree
```{r}
modelo_tree <- tree(letra ~ ., data = select(d_treino, -arq))
cv_tree <- cv.tree(modelo_tree)
plot(cv_tree)
modelo_tree <- prune.tree(modelo_tree, best = 25)
save(d_treino, file = 'data/d_treino.rda')
save(modelo_tree, file = 'data/modelo.rda')
devtools::document(); devtools::install()
```

#### Random Forest
```{r}
set.seed(19910401)
modelo_rf <- train(letra ~ ., 
                   data = select(d_treino, -arq),
                   method = "rf",
                   tuneLength = 6)

plot(modelo_rf)
modelo <- modelo_rf$finalModel
save(modelo, file = 'data/modelo.rda')

teste <- carregar_teste(d)
nm <- names(select(d_treino, -arq, -letra))
teste[, nm[!nm %in% names(teste)]] <- 0
predicao <- predict(modelo, teste, type = "class")
r <- paste0(predicao, collapse = "")
r
```

### Prever!

```{r}
d <- ler("arq.png"); desenhar(d); prever(d)
```

